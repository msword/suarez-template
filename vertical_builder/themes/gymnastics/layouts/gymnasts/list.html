{{ define "main" }}
<section class="page-shell coaches-page">
  <h1>{{ .Title }}</h1>
  <p class="lead">Active roster profiles for the current cycle.</p>
  <div class="coaches-grid">
    {{ $pages := where .RegularPages "Draft" false }}
    {{ range sort $pages "Title" }}
      {{ $model := partial "content_model.html" . }}
      {{ $data := $model.data }}
      {{ $status := .Params.status | default "active" }}
      {{ if eq $status "active" }}
      {{ $photo := index $data "profileImage" | default (index $data "photo" | default (index $data "photoUrl" | default (index $data "imageUrl" | default (index $data "image" | default "")))) }}
      {{ $summary := $model.intro }}
      {{ if eq ($summary | default "") "" }}
        {{ $summary = printf "Level %v" (index $data "level" | default "TBD") }}
        {{ with index $data "gender" }}{{ $summary = printf "%s | %s" $summary (. | title) }}{{ end }}
      {{ end }}
      <article class="coach-card">
        <a class="coach-card-link" href="{{ .RelPermalink }}">
          <div class="coach-avatar">
            {{ if ne ($photo | default "") "" }}
              <img src="{{ $photo }}" alt="{{ $model.title }} profile photo" loading="lazy" decoding="async">
            {{ else }}
              {{ $parts := split $model.title " " }}
              {{ $initials := "" }}
              {{ range first 2 $parts }}
                {{ if gt (len .) 0 }}
                  {{ $initials = printf "%s%s" $initials (upper (substr . 0 1)) }}
                {{ end }}
              {{ end }}
              <span class="coach-avatar-fallback" aria-hidden="true">{{ $initials }}</span>
            {{ end }}
          </div>
          <div class="coach-copy">
            <h2>{{ $model.title }}</h2>
            <p>{{ $summary }}</p>
          </div>
        </a>
      </article>
      {{ end }}
    {{ end }}
  </div>
</section>
{{ end }}
