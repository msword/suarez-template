<!DOCTYPE html>
<html lang="en">
  {{ partial "head.html" . }}
  <body>
    <div class="site-shell">
      {{ partial "header.html" . }}
      <main class="page-main{{ if .IsHome }} page-main-home{{ end }}">
        {{ block "main" . }}{{ end }}
      </main>
      {{ partial "footer.html" . }}
    </div>

    <script>
      (function () {
        const root = document.documentElement;
        const toggle = document.getElementById("theme-toggle");
        const menuToggle = document.getElementById("menu-toggle");
        const headerInner = document.querySelector(".site-header-inner");
        const nav = document.getElementById("site-nav");

        const saved = localStorage.getItem("theme");
        const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;

        if (saved === "dark" || (!saved && prefersDark)) {
          root.classList.add("dark");
        }

        if (toggle) {
          toggle.addEventListener("click", function () {
            const isDark = root.classList.toggle("dark");
            localStorage.setItem("theme", isDark ? "dark" : "light");
          });
        }

        if (menuToggle && headerInner && nav) {
          const closeMenu = function () {
            headerInner.classList.remove("mobile-nav-open");
            menuToggle.setAttribute("aria-expanded", "false");
          };

          menuToggle.addEventListener("click", function () {
            const open = headerInner.classList.toggle("mobile-nav-open");
            menuToggle.setAttribute("aria-expanded", open ? "true" : "false");
          });

          nav.querySelectorAll("a").forEach(function (link) {
            link.addEventListener("click", closeMenu);
          });

          window.addEventListener("resize", function () {
            if (window.innerWidth > 768) {
              closeMenu();
            }
          });
        }

        const initHeroCarousel = function () {
          const carousels = document.querySelectorAll("[data-carousel='hero']");
          carousels.forEach(function (carousel) {
            const slides = Array.from(carousel.querySelectorAll(".hero-slide"));
            const dots = Array.from(carousel.querySelectorAll(".hero-dot"));
            if (slides.length < 2 || dots.length < 2) {
              return;
            }

            let activeIndex = slides.findIndex(function (slide) {
              return slide.classList.contains("is-active");
            });
            if (activeIndex < 0) activeIndex = 0;

            const setActive = function (nextIndex) {
              const normalized = (nextIndex + slides.length) % slides.length;
              slides.forEach(function (slide, i) {
                slide.classList.toggle("is-active", i === normalized);
              });
              dots.forEach(function (dot, i) {
                const isActive = i === normalized;
                dot.classList.toggle("is-active", isActive);
                dot.setAttribute("aria-selected", isActive ? "true" : "false");
              });
              activeIndex = normalized;
            };

            dots.forEach(function (dot, i) {
              dot.addEventListener("click", function () {
                setActive(i);
              });
            });

            let autoTimer = null;
            const startAuto = function () {
              if (autoTimer) return;
              autoTimer = window.setInterval(function () {
                setActive(activeIndex + 1);
              }, 8000);
            };
            const stopAuto = function () {
              if (!autoTimer) return;
              window.clearInterval(autoTimer);
              autoTimer = null;
            };

            carousel.addEventListener("mouseenter", stopAuto);
            carousel.addEventListener("mouseleave", startAuto);
            carousel.addEventListener("focusin", stopAuto);
            carousel.addEventListener("focusout", startAuto);
            startAuto();
          });
        };

        initHeroCarousel();
      })();
    </script>
  </body>
</html>
