{{ $data := partial "data_bundle.html" . }} {{ $orgName := $data.org.orgName |
default "" }} {{ $orgLogo := $data.org.logoPath | default "" }} {{ $logoURL :=
"" }} {{ with $data.org.branding.logoUrl }}{{ $logoURL = . }}{{ end }} {{ with
$data.settings.branding.logoUrl }}{{ $logoURL = . }}{{ end }} {{ if ne $logoURL
"" }}{{ $orgLogo = $logoURL }}{{ end }} {{ with $data.settings.branding.logo
}}{{ $orgLogo = . }}{{ end }} {{ if eq $orgLogo "" }}{{ $orgLogo =
"/images/logo.jpg" }}{{ end }} {{ $orgSlug := $data.org.orgId | default
(.Site.Params.orgSlug | default "") }} {{ $eventsPath := "/calendar/" }} {{ if
ne $orgSlug "" }}{{ $eventsPath = printf "/%s/calendar/" $orgSlug }}{{ end }}
{{/* ---------------------------------- */}} {{/* NAV ITEMS */}} {{/*
---------------------------------- */}} {{ $navItems := slice }} {{ with
$data.navigation.items }}{{ $navItems = . }}{{ end }} {{ if eq (len $navItems) 0
}} {{ $navItems = slice (dict "label" "Home" "url" "/") (dict "label" "Gymnasts"
"url" "/gymnasts/") (dict "label" "Coaches" "url" "/coaches/") (dict "label"
"Meets" "url" "/meets/") }} {{ end }} {{ $navSorted := sort $navItems "order"
"asc" }} {{ $showDropdown := gt (len $navSorted) 5 }} {{ $visibleNav := cond
$showDropdown (first 4 $navSorted) $navSorted }} {{ $overflowNav := cond
$showDropdown (after 4 $navSorted) (slice) }} {{/*
---------------------------------- */}} {{/* MEETS GROUPING (JSON SAFE) */}}
{{/* ---------------------------------- */}} {{ $meetPages := where
site.RegularPages "Section" "meets" }} {{ $meetPages = where $meetPages "Draft"
false }} {{ $meetRows := slice }} {{ range $meetPages }} {{ $model := partial
"content_model.html" . }} {{ $start := index $model.data "startDate" | default
(index $model.data "date" | default "") }} {{ if ne (printf "%v" $start) "" }}
{{ $year := dateFormat "2006" $start }} {{ $meetRows = $meetRows | append (dict
"page" . "title" $model.title "year" $year "start" $start ) }} {{ end }} {{ end
}} {{ $meetRows = sort $meetRows "start" "desc" }} {{ $meetsByYear := dict }} {{
$meetYears := slice }} {{ range $meetRows }} {{ if not (isset $meetsByYear
.year) }} {{ $meetYears = $meetYears | append .year }} {{ $meetsByYear = merge
$meetsByYear (dict .year (slice)) }} {{ end }} {{ $bucket := index $meetsByYear
.year }} {{ $bucket = $bucket | append . }} {{ $meetsByYear = merge $meetsByYear
(dict .year $bucket) }} {{ end }} {{/* ---------------------------------- */}}
{{/* CUSTOM PAGES */}} {{/* ---------------------------------- */}} {{
$customPages := where site.RegularPages "Section" "pages" }} {{ $customPagesAlt
:= where site.RegularPages "Section" "__c" }} {{ $customPages = $customPages |
append $customPagesAlt }} {{ $customPages = where $customPages "Draft" false }}
{{ $customLimited := first 4 $customPages }} {{ $hasMoreCustom := gt (len
$customPages) 4 }}

<header class="site-header">
  <div class="site-header-inner">
    <div class="site-brand">
      {{ if ne $orgLogo "" }}
      <img class="site-logo" src="{{ $orgLogo }}" alt="{{ $orgName }} logo" />
      {{ else }}
      <span class="site-org-name">{{ $orgName }}</span>
      {{ end }}
    </div>

    <button
      id="menu-toggle"
      class="menu-toggle"
      aria-label="Toggle navigation menu"
      type="button"
    >
      <span class="menu-toggle-line"></span>
      <span class="menu-toggle-line"></span>
      <span class="menu-toggle-line"></span>
    </button>

    <nav id="site-nav" class="site-nav" aria-label="Primary">
      {{/* MAIN NAV LINKS */}} {{ range $visibleNav }} {{ $label := title (lower
      (printf "%v" (index . "label" | default ""))) }} {{ $url := index . "url"
      | default "" }} {{/* Prevent duplicate Meets link if we render dropdown
      */}} {{ if ne $label "Meets" }} {{ if eq $label "Events" }}{{ $url =
      $eventsPath }}{{ end }}
      <a class="nav-link" href="{{ $url }}">{{ $label }}</a>
      {{ end }} {{ end }} {{/* OVERFLOW DROPDOWN */}} {{ if $showDropdown }}
      <details class="nav-dropdown">
        <summary class="nav-link nav-dropdown-trigger">More</summary>
        <div class="nav-dropdown-menu">
          {{ range $overflowNav }} {{ $label := title (lower (printf "%v" (index
          . "label" | default ""))) }} {{ $url := index . "url" | default "" }}
          {{ if ne $label "Meets" }}
          <a class="nav-dropdown-link" href="{{ $url }}">{{ $label }}</a>
          {{ end }} {{ end }}
        </div>
      </details>
      {{ end }} {{/* MEETS DROPDOWN (GROUPED BY YEAR) */}} {{ if gt (len
      $meetYears) 0 }}
      <details class="nav-dropdown nav-dropdown-wide">
        <summary class="nav-link nav-dropdown-trigger">Meets</summary>
        <div class="nav-dropdown-menu">
          {{ range $meetYears }}
          <div class="nav-dropdown-group">
            <p class="nav-dropdown-group-title">{{ . }}</p>
            {{ range index $meetsByYear . }}
            <a class="nav-dropdown-link" href="{{ .page.RelPermalink }}"
              >{{ .title }}</a
            >
            {{ end }}
          </div>
          {{ end }}
        </div>
      </details>
      {{ end }} {{/* CUSTOM PAGES */}} {{ if gt (len $customPages) 0 }}
      <details class="nav-dropdown">
        <summary class="nav-link nav-dropdown-trigger">Pages</summary>
        <div class="nav-dropdown-menu">
          {{ range $customLimited }} {{ $model := partial "content_model.html" .
          }}
          <a class="nav-dropdown-link" href="{{ .RelPermalink }}"
            >{{ $model.title }}</a
          >
          {{ end }} {{ if $hasMoreCustom }}
          <a class="nav-dropdown-link" href="/pages/">View all</a>
          {{ end }}
        </div>
      </details>
      {{ end }}
    </nav>
  </div>
</header>
